<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>just one minute</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
  display: flex;
  min-height: 100vh;
  flex-direction: row;
  overflow: hidden;
}

.sidebar {
  width: 320px;
  background: linear-gradient(180deg, #0f0f0f 0%, #1a1a1a 100%);
  border-right: 2px solid #2a2a2a;
  display: flex;
  flex-direction: column;
  height: 100vh;
  position: relative;
  top: 0;
  left: 0;
  z-index: 10;
  box-shadow: 4px 0 20px rgba(0, 0, 0, 0.5);
  transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  transform: translateX(0);
}

.sidebar-toggle {
  display: none; /* hidden on desktop */
}

.main-content {
  flex: 1;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  height: 100vh;
  overflow-y: auto;
  padding: 0 40px;
  margin-left: 0;
}

@media (max-width: 1024px) {
  .sidebar {
    width: 250px;
  }
  .main-content {
    padding: 0 10px;
  }
}

@media (max-width: 768px) {
  body {
    flex-direction: column;
  }
  .sidebar {
    position: fixed;
    top: 0;
    left: 0;
    height: 100vh;
    z-index: 1001;
    transform: translateX(-100%);
  }
  .sidebar.open {
    transform: translateX(0);
    box-shadow: 4px 0 20px rgba(0, 0, 0, 0.8);
  }
  .sidebar-toggle {
    display: flex;
    position: fixed;
    top: 18px;
    left: 18px;
    z-index: 1100;
  }
  .main-content {
    margin-left: 0;
    width: 100vw;
    padding: 0 4vw;
  }
}

@media (max-width: 480px) {
  .sidebar {
    width: 85vw;
    min-width: 210px;
  }
  .main-content {
    padding: 0 2vw;
  }
}

  </style>
</head>
<body>
  <div class="header">
    <a href="https://goldmancreates.substack.com" target="_blank" class="header-text">
      join my newsletter -- goldmancreates.substack.com
    </a>
  </div>
  
  <button type="button" id="sidebarToggle" class="sidebar-toggle">
    <span id="toggleIcon" class="toggle-icon">ðŸ“œ</span>
  </button>
  <div class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <h2>History</h2>
    </div>
    <div class="history-content">
      <div id="historyList"></div>
      <button type="button" id="clearHistoryBtn" class="clear-history">Clear History</button>
    </div>
  </div>
  <div class="main-content">
    <div class="container">
      <h1>...just one minute</h1>
      <input id="threadUrl" type="text" placeholder="Paste Twitter thread link (optional)">
      <textarea id="rawText" placeholder="Paste any text to summarize" rows="4"></textarea>
      <select id="length">
        <option value="1 line">1 line</option>
        <option value="3 sentences" selected>3 sentences</option>
        <option value="bullet list">bullet list</option>
      </select>
      <select id="tone">
        <option value="simple">simple</option>
        <option value="professional">professional</option>
        <option value="conversational">conversational</option>
        <option value="shitpost">shitpost</option>
        <option value="infographics">infographics</option>
      </select>
      <button type="button" id="summarizeBtn">summarize</button>
      <div id="error"></div>
      <div class="summary-container" id="summaryContainer" style="display: none;">
        <div id="summaryDisplay" class="summary-display"></div>
        <button type="button" id="copyBtn" class="copy-btn">Copy to Clipboard</button>
      </div>
    </div>
  </div>
  
  <div class="footer">
    <div class="footer-text">...made with ðŸ–¤ by goldman</div>
  </div>
  
<script>
  console.log('script loaded');
  const btn = document.getElementById('summarizeBtn');
  const errorEl = document.getElementById('error');
  const summaryEl = document.getElementById('summary');
  const threadInput = document.getElementById('threadUrl');
  const rawTextInput = document.getElementById('rawText');
  const lengthSelect = document.getElementById('length');
  const toneSelect = document.getElementById('tone');
  const summaryContainer = document.getElementById('summaryContainer');
  const summaryDisplay = document.getElementById('summaryDisplay');
  const copyBtn = document.getElementById('copyBtn');
  const historyList = document.getElementById('historyList');
  const clearHistoryBtn = document.getElementById('clearHistoryBtn');
  
  // Sidebar toggle functionality
  const sidebar = document.getElementById('sidebar');
  const sidebarToggle = document.getElementById('sidebarToggle');
  const toggleIcon = document.getElementById('toggleIcon');
  let sidebarOpen = false;
  
  sidebarToggle.addEventListener('click', (e) => {
    e.stopPropagation();
    sidebarOpen = !sidebarOpen;
    if (sidebarOpen) {
      sidebar.classList.add('open');
      sidebarToggle.classList.add('open');
      toggleIcon.textContent = 'âœ•';
    } else {
      sidebar.classList.remove('open');
      sidebarToggle.classList.remove('open');
      toggleIcon.textContent = 'ðŸ“œ';
    }
  });
  
  // Close sidebar when clicking outside
  document.addEventListener('click', (e) => {
    if (sidebarOpen && 
        !sidebar.contains(e.target) && 
        !sidebarToggle.contains(e.target)) {
      sidebarOpen = false;
      sidebar.classList.remove('open');
      sidebarToggle.classList.remove('open');
      toggleIcon.textContent = 'ðŸ“œ';
    }
  });
  
  // Load history from localStorage
  let summaryHistory = JSON.parse(localStorage.getItem('summaryHistory') || '[]');
  
  function saveToHistory(summary, source, length, tone) {
    const historyItem = {
      id: Date.now(),
      summary,
      source: source.length > 50 ? source.substring(0, 50) + '...' : source,
      length,
      tone,
      timestamp: new Date().toLocaleString()
    };
    summaryHistory.unshift(historyItem);
    if (summaryHistory.length > 50) summaryHistory = summaryHistory.slice(0, 50); // Keep only last 50
    localStorage.setItem('summaryHistory', JSON.stringify(summaryHistory));
    renderHistory();
  }
  
  function renderHistory() {
    if (!historyList) return;
    historyList.innerHTML = summaryHistory.map(item => `
      <div class="history-item" onclick="loadHistoryItem(${item.id})">
        <div class="history-meta">${item.timestamp} â€¢ ${item.length} â€¢ ${item.tone}</div>
        <div class="history-preview">${escapeHtml(item.summary)}</div>
      </div>
    `).join('');
  }
  
  window.loadHistoryItem = function(id) {
    const item = summaryHistory.find(h => h.id === id);
    if (item && summaryDisplay && summaryContainer) {
      summaryDisplay.innerHTML = formatSummary(item.summary);
      summaryContainer.style.display = 'block';
    }
  }
  
  // Format summary text with proper HTML formatting
  function formatSummary(text) {
    return text
      // Convert **bold** to <strong>
      .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
      // Convert *italic* to <em>
      .replace(/\*(.*?)\*/g, '<em>$1</em>')
      // Convert bullet points
      .replace(/^[â€¢Â·-]\s+(.+)$/gm, '<li>$1</li>')
      // Wrap consecutive list items in <ul>
      .replace(/(<li>.*<\/li>)/g, '<ul>$1</ul>')
      // Convert numbered lists
      .replace(/^\d+\.\s+(.+)$/gm, '<li>$1</li>')
      // Convert ### headers
      .replace(/^###\s+(.+)$/gm, '<h3>$1</h3>')
      // Convert ## headers
      .replace(/^##\s+(.+)$/gm, '<h2>$1</h2>')
      // Convert # headers
      .replace(/^#\s+(.+)$/gm, '<h1>$1</h1>');
  }
  
  // Copy to clipboard functionality
  copyBtn?.addEventListener('click', async () => {
    if (!summaryDisplay) return;
    try {
      await navigator.clipboard.writeText(summaryDisplay.textContent || summaryDisplay.innerText);
      const originalText = copyBtn.textContent;
      copyBtn.textContent = 'Copied!';
      setTimeout(() => {
        copyBtn.textContent = originalText;
      }, 2000);
    } catch (err) {
      // Fallback for older browsers
      const range = document.createRange();
      range.selectNode(summaryDisplay);
      const originalText = copyBtn.textContent;
      copyBtn.textContent = 'Copied!';
      setTimeout(() => {
        copyBtn.textContent = originalText;
      }, 2000);
    }
  });
  
  // Clear history functionality
  clearHistoryBtn?.addEventListener('click', () => {
    if (confirm('Are you sure you want to clear all history?')) {
      summaryHistory = [];
      localStorage.removeItem('summaryHistory');
      renderHistory();
    }
  });
  
  // Initialize history display
  renderHistory();

  // Helper function to escape HTML characters
  function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
  }

  btn?.addEventListener('click', async () => {
    if (!errorEl || !summaryDisplay || !summaryContainer) return;
    errorEl.textContent = '';
    summaryDisplay.innerHTML = 'Loading...';
    summaryDisplay.classList.add('loading');
    summaryContainer.style.display = 'block';

    const threadUrl = threadInput instanceof HTMLInputElement ? threadInput.value.trim() : '';
    const rawText = rawTextInput instanceof HTMLTextAreaElement ? rawTextInput.value.trim() : '';
    const length = lengthSelect instanceof HTMLSelectElement ? lengthSelect.value : '';
    const tone = toneSelect instanceof HTMLSelectElement ? toneSelect.value : '';

    if (!threadUrl && !rawText) {
      errorEl.textContent = 'Enter a Twitter link or paste some text.';
      summaryDisplay.innerHTML = '';
      summaryDisplay.classList.remove('loading');
      summaryContainer.style.display = 'none';
      return;
    }

    try {
      const res = await fetch('/summarize', {
        method: 'POST', headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ threadUrl, rawText, length, tone })
      });
      const data = await res.json();
      if (data.error) throw new Error(data.error);
      summaryDisplay.innerHTML = formatSummary(data.summary);
      summaryDisplay.classList.remove('loading');
      
      // Save to history
      const source = threadUrl || rawText;
      saveToHistory(data.summary, source, length, tone);
    } catch (err) {
      errorEl.textContent = err.message || 'Error occurred';
      summaryDisplay.innerHTML = '';
      summaryDisplay.classList.remove('loading');
      summaryContainer.style.display = 'none';
    }
  });
</script>
</body>
</html>