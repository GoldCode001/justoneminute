<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>just one minute</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body { 
      margin: 0; 
      padding: 0; 
      background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
      color: #f5f5f5; 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
      display: flex; 
      min-height: 100vh;
      overflow: hidden;
    }
    
    .sidebar { 
      width: 320px; 
      background: linear-gradient(180deg, #0f0f0f 0%, #1a1a1a 100%);
      border-right: 2px solid #2a2a2a;
      display: flex;
      flex-direction: column;
      height: 100vh;
      box-shadow: 4px 0 20px rgba(0, 0, 0, 0.5);
    }
    
    .sidebar-header {
      padding: 24px 20px 16px;
      border-bottom: 1px solid #2a2a2a;
      background: linear-gradient(135deg, #1a1a1a 0%, #0f0f0f 100%);
    }
    
    .sidebar h2 { 
      font-size: 1.4em; 
      margin: 0;
      color: #ffd700; 
      font-weight: 600;
      text-shadow: 0 2px 4px rgba(255, 215, 0, 0.3);
    }
    
    .history-content {
      flex: 1;
      overflow-y: auto;
      padding: 16px 20px;
    }
    
    .history-content::-webkit-scrollbar {
      width: 8px;
    }
    
    .history-content::-webkit-scrollbar-track {
      background: #1a1a1a;
      border-radius: 4px;
    }
    
    .history-content::-webkit-scrollbar-thumb {
      background: linear-gradient(180deg, #ffd700 0%, #ffed4e 100%);
      border-radius: 4px;
      box-shadow: 0 2px 4px rgba(255, 215, 0, 0.3);
    }
    
    .history-content::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(180deg, #ffed4e 0%, #ffd700 100%);
    }
    
    .main-content { 
      flex: 1; 
      display: flex; 
      justify-content: center; 
      align-items: flex-start;
      height: 100vh;
      overflow-y: auto;
      padding: 0 20px;
    }
    
    .main-content::-webkit-scrollbar {
      width: 8px;
    }
    
    .main-content::-webkit-scrollbar-track {
      background: #1a1a1a;
      border-radius: 4px;
    }
    
    .main-content::-webkit-scrollbar-thumb {
      background: linear-gradient(180deg, #ffd700 0%, #ffed4e 100%);
      border-radius: 4px;
      box-shadow: 0 2px 4px rgba(255, 215, 0, 0.3);
    }
    
    .main-content::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(180deg, #ffed4e 0%, #ffd700 100%);
    }
    
    .container { 
      width: 100%; 
      max-width: 700px; 
      margin: 40px 0;
    }
    
    h1 { 
      font-size: 2.8em;
      font-weight: 700;
      margin-bottom: 32px;
      background: linear-gradient(135deg, #ffd700 0%, #ffed4e 50%, #ffd700 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-align: center;
      text-shadow: 0 4px 8px rgba(255, 215, 0, 0.3);
      letter-spacing: -0.02em;
    }
    
    input, select { 
      width: 100%; 
      padding: 16px 20px; 
      margin: 12px 0; 
      background: linear-gradient(135deg, #0f0f0f 0%, #1a1a1a 100%);
      color: #f5f5f5; 
      border: 2px solid #2a2a2a;
      border-radius: 16px; 
      font-size: 1.1em;
      font-weight: 500;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }
    
    input:focus, select:focus {
      outline: none;
      border-color: #ffd700;
      box-shadow: 0 0 0 4px rgba(255, 215, 0, 0.2), 0 8px 24px rgba(0, 0, 0, 0.4);
      transform: translateY(-2px);
    }
    
    input::placeholder {
      color: #888;
      font-weight: 400;
    }
    
    textarea { 
      width: 100%; 
      padding: 16px 20px; 
      background: linear-gradient(135deg, #0f0f0f 0%, #1a1a1a 100%);
      color: #f5f5f5; 
      border: 2px solid #2a2a2a;
      border-radius: 16px; 
      margin: 12px 0; 
      font-size: 1.1em; 
      font-weight: 500;
      resize: vertical;
      min-height: 120px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      font-family: inherit;
    }
    
    textarea:focus {
      outline: none;
      border-color: #ffd700;
      box-shadow: 0 0 0 4px rgba(255, 215, 0, 0.2), 0 8px 24px rgba(0, 0, 0, 0.4);
      transform: translateY(-2px);
    }
    
    textarea::placeholder {
      color: #888;
      font-weight: 400;
    }
    
    button { 
      width: 100%; 
      padding: 18px 24px; 
      margin-top: 20px; 
      background: linear-gradient(135deg, #ffd700 0%, #ffed4e 50%, #ffd700 100%);
      color: #0a0a0a; 
      font-size: 1.2em; 
      font-weight: 700;
      border: none; 
      border-radius: 20px; 
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 6px 20px rgba(255, 215, 0, 0.4);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    button:hover { 
      transform: translateY(-3px);
      box-shadow: 0 12px 32px rgba(255, 215, 0, 0.6);
      background: linear-gradient(135deg, #ffed4e 0%, #ffd700 50%, #ffed4e 100%);
    }
    
    button:active {
      transform: translateY(-1px);
      box-shadow: 0 4px 16px rgba(255, 215, 0, 0.5);
    }
    
    .summary-container { 
      margin-top: 32px;
      background: linear-gradient(135deg, #0f0f0f 0%, #1a1a1a 100%);
      border: 2px solid #2a2a2a;
      border-radius: 20px;
      padding: 24px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
    }
    
    .summary-display { 
      width: 100%; 
      min-height: 150px; 
      background: linear-gradient(135deg, #1a1a1a 0%, #0f0f0f 100%);
      color: #f5f5f5; 
      border: 2px solid #2a2a2a;
      border-radius: 16px; 
      padding: 20px; 
      font-size: 1.1em; 
      line-height: 1.7; 
      white-space: pre-wrap; 
      word-wrap: break-word;
      box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.3);
    }
    
    .summary-display strong { 
      color: #ffd700; 
      font-weight: 700;
      text-shadow: 0 1px 2px rgba(255, 215, 0, 0.3);
    }
    
    .summary-display em { 
      color: #ffed4e; 
      font-style: italic; 
    }
    
    .summary-display ul, .summary-display ol { 
      margin: 12px 0; 
      padding-left: 24px; 
    }
    
    .summary-display li { 
      margin: 6px 0;
      color: #e5e5e5;
    }
    
    .summary-display h1, .summary-display h2, .summary-display h3 { 
      color: #ffd700; 
      margin: 16px 0 12px 0;
      text-shadow: 0 2px 4px rgba(255, 215, 0, 0.3);
    }
    
    .copy-btn { 
      width: auto; 
      padding: 12px 24px; 
      margin-top: 16px; 
      background: linear-gradient(135deg, #2a2a2a 0%, #3a3a3a 100%);
      color: #ffd700;
      font-size: 1em; 
      font-weight: 600;
      border-radius: 12px;
      border: 2px solid #ffd700;
      box-shadow: 0 4px 12px rgba(255, 215, 0, 0.2);
    }
    
    .copy-btn:hover {
      background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
      color: #0a0a0a;
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(255, 215, 0, 0.4);
    }
    
    .error { 
      background: linear-gradient(135deg, #2a0a0a 0%, #3a1515 100%);
      padding: 16px 20px; 
      border-radius: 16px; 
      margin-top: 20px; 
      color: #ff6b6b;
      border: 2px solid #4a1515;
      box-shadow: 0 4px 12px rgba(255, 107, 107, 0.2);
      font-weight: 500;
    }
    
    .history-item { 
      background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
      padding: 16px; 
      border-radius: 12px; 
      margin-bottom: 12px; 
      cursor: pointer; 
      border: 2px solid transparent;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }
    
    .history-item:hover { 
      border-color: #ffd700;
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(255, 215, 0, 0.2);
      background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%);
    }
    
    .history-meta { 
      font-size: 0.85em; 
      color: #ffd700; 
      margin-bottom: 8px;
      font-weight: 600;
    }
    
    .history-preview { 
      font-size: 0.95em; 
      line-height: 1.4; 
      overflow: hidden; 
      display: -webkit-box; 
      -webkit-line-clamp: 3; 
      -webkit-box-orient: vertical;
      color: #e5e5e5;
    }
    
    .clear-history { 
      background: linear-gradient(135deg, #2a0a0a 0%, #3a1515 100%);
      color: #ff6b6b; 
      padding: 12px 16px; 
      font-size: 0.9em; 
      margin: 16px 0 0 0;
      border: 2px solid #4a1515;
      font-weight: 600;
      box-shadow: 0 4px 12px rgba(255, 107, 107, 0.2);
    }
    
    .clear-history:hover {
      background: linear-gradient(135deg, #ff6b6b 0%, #ff5252 100%);
      color: #fff;
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(255, 107, 107, 0.4);
    }

    /* Custom select styling */
    select {
      appearance: none;
      background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23ffd700' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: right 16px center;
      background-size: 20px;
      padding-right: 50px;
    }

    /* Loading animation */
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .loading {
      animation: pulse 1.5s ease-in-out infinite;
    }
  </style>
</head>
<body>
  <div class="sidebar">
    <div class="sidebar-header">
      <h2>History</h2>
    </div>
    <div class="history-content">
      <div id="historyList"></div>
      <button type="button" id="clearHistoryBtn" class="clear-history">Clear History</button>
    </div>
  </div>
  <div class="main-content">
    <div class="container">
      <h1>...just one minute</h1>
      <input id="threadUrl" type="text" placeholder="Paste Twitter thread link (optional)">
      <textarea id="rawText" placeholder="Paste any text to summarize" rows="4"></textarea>
      <select id="length">
        <option value="1 line">1 line</option>
        <option value="3 sentences" selected>3 sentences</option>
        <option value="bullet list">bullet list</option>
      </select>
      <select id="tone">
        <option value="simple">simple</option>
        <option value="professional">professional</option>
        <option value="conversational">conversational</option>
      </select>
      <button type="button" id="summarizeBtn">summarize</button>
      <div id="error"></div>
      <div class="summary-container" id="summaryContainer" style="display: none;">
        <div id="summaryDisplay" class="summary-display"></div>
        <button type="button" id="copyBtn" class="copy-btn">Copy to Clipboard</button>
      </div>
    </div>
  </div>
<script>
  console.log('script loaded');
  const btn = document.getElementById('summarizeBtn');
  const errorEl = document.getElementById('error');
  const summaryEl = document.getElementById('summary');
  const threadInput = document.getElementById('threadUrl');
  const rawTextInput = document.getElementById('rawText');
  const lengthSelect = document.getElementById('length');
  const toneSelect = document.getElementById('tone');
  const summaryContainer = document.getElementById('summaryContainer');
  const summaryDisplay = document.getElementById('summaryDisplay');
  const copyBtn = document.getElementById('copyBtn');
  const historyList = document.getElementById('historyList');
  const clearHistoryBtn = document.getElementById('clearHistoryBtn');
  
  // Load history from localStorage
  let summaryHistory = JSON.parse(localStorage.getItem('summaryHistory') || '[]');
  
  function saveToHistory(summary, source, length, tone) {
    const historyItem = {
      id: Date.now(),
      summary,
      source: source.length > 50 ? source.substring(0, 50) + '...' : source,
      length,
      tone,
      timestamp: new Date().toLocaleString()
    };
    summaryHistory.unshift(historyItem);
    if (summaryHistory.length > 50) summaryHistory = summaryHistory.slice(0, 50); // Keep only last 50
    localStorage.setItem('summaryHistory', JSON.stringify(summaryHistory));
    renderHistory();
  }
  
  function renderHistory() {
    if (!historyList) return;
    historyList.innerHTML = summaryHistory.map(item => `
      <div class="history-item" onclick="loadHistoryItem(${item.id})">
        <div class="history-meta">${item.timestamp} • ${item.length} • ${item.tone}</div>
        <div class="history-preview">${item.summary}</div>
      </div>
    `).join('');
  }
  
  window.loadHistoryItem = function(id) {
    const item = summaryHistory.find(h => h.id === id);
    if (item && summaryDisplay && summaryContainer) {
      summaryDisplay.innerHTML = formatSummary(item.summary);
      summaryContainer.style.display = 'block';
    }
  }
  
  // Format summary text with proper HTML formatting
  function formatSummary(text) {
    return text
      // Convert **bold** to <strong>
      .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
      // Convert *italic* to <em>
      .replace(/\*(.*?)\*/g, '<em>$1</em>')
      // Convert bullet points
      .replace(/^[•·-]\s+(.+)$/gm, '<li>$1</li>')
      // Wrap consecutive list items in <ul>
      .replace(/(<li>.*<\/li>)/gs, '<ul>$1</ul>')
      // Convert numbered lists
      .replace(/^\d+\.\s+(.+)$/gm, '<li>$1</li>')
      // Convert ### headers
      .replace(/^###\s+(.+)$/gm, '<h3>$1</h3>')
      // Convert ## headers
      .replace(/^##\s+(.+)$/gm, '<h2>$1</h2>')
      // Convert # headers
      .replace(/^#\s+(.+)$/gm, '<h1>$1</h1>');
  }
  
  // Copy to clipboard functionality
  copyBtn?.addEventListener('click', async () => {
    if (!summaryDisplay) return;
    try {
      await navigator.clipboard.writeText(summaryDisplay.textContent || summaryDisplay.innerText);
      const originalText = copyBtn.textContent;
      copyBtn.textContent = 'Copied!';
      setTimeout(() => {
        copyBtn.textContent = originalText;
      }, 2000);
    } catch (err) {
      // Fallback for older browsers
      const range = document.createRange();
      range.selectNode(summaryDisplay);
      const originalText = copyBtn.textContent;
      copyBtn.textContent = 'Copied!';
      setTimeout(() => {
        copyBtn.textContent = originalText;
      }, 2000);
    }
  });
  
  // Clear history functionality
  clearHistoryBtn?.addEventListener('click', () => {
    if (confirm('Are you sure you want to clear all history?')) {
      summaryHistory = [];
      localStorage.removeItem('summaryHistory');
      renderHistory();
    }
  });
  
  // Initialize history display
  renderHistory();

  btn?.addEventListener('click', async () => {
    if (!errorEl || !summaryDisplay || !summaryContainer) return;
    errorEl.textContent = '';
    summaryDisplay.innerHTML = 'Loading...';
    summaryDisplay.classList.add('loading');
    summaryContainer.style.display = 'block';

    const threadUrl = threadInput instanceof HTMLInputElement ? threadInput.value.trim() : '';
    const rawText = rawTextInput instanceof HTMLTextAreaElement ? rawTextInput.value.trim() : '';
    const length = lengthSelect instanceof HTMLSelectElement ? lengthSelect.value : '';
    const tone = toneSelect instanceof HTMLSelectElement ? toneSelect.value : '';

    if (!threadUrl && !rawText) {
      errorEl.textContent = 'Enter a Twitter link or paste some text.';
      summaryDisplay.innerHTML = '';
      summaryDisplay.classList.remove('loading');
      summaryContainer.style.display = 'none';
      return;
    }

    try {
      const res = await fetch('/summarize', {
        method: 'POST', headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ threadUrl, rawText, length, tone })
      });
      const data = await res.json();
      if (data.error) throw new Error(data.error);
      summaryDisplay.innerHTML = formatSummary(data.summary);
      summaryDisplay.classList.remove('loading');
      
      // Save to history
      const source = threadUrl || rawText;
      saveToHistory(data.summary, source, length, tone);
    } catch (err) {
      errorEl.textContent = err.message || 'Error occurred';
      summaryDisplay.innerHTML = '';
      summaryDisplay.classList.remove('loading');
      summaryContainer.style.display = 'none';
    }
  });
</script>
</body>
</html>